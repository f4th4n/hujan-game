const config={mode:"development",debug:!1},data={categories:["flower","wood","fruit","herb","magical"],levels:[{index:1,dropRate:{flower:.75,wood:.25,fruit:0,herb:0,magical:0}},{index:2,dropRate:{flower:.3,wood:.7,fruit:0,herb:0,magical:0}},{index:3,dropRate:{flower:.2,wood:.2,fruit:.6,herb:0,magical:0}}],plants:[{id:1,name:"Melati",category:"flower",bloomInSeconds:5,funFact:""},{id:2,name:"Mawar",category:"flower",bloomInSeconds:5,funFact:""},{id:3,name:"Sepatu",category:"flower",bloomInSeconds:5,funFact:""},{id:4,name:"Bangkai",category:"flower",bloomInSeconds:5,funFact:""},{id:5,name:"Tulip",category:"flower",bloomInSeconds:5,funFact:""}]},helper={virtual:{width:480,height:270},zOrder:{zero:0,low:1,medium:5,high:10},insideFBIframe:()=>{try{return window.self!==window.top}catch(e){return!0}}};var model={user:{firstTime:!0,plantsOnGround:[],plantsCollection:[]},local:{cloud:{scheduleUpdatePos:{x:0,on:+new Date}},scheduleSeedsOn:[]},async initUser(){const e=localStorage.getItem("user");null!==e&&(this.user=JSON.parse(e))},setUser(e,t){this.user[e]=t,localStorage.setItem("user",JSON.stringify(this.user))},getUser(e){return this.user[e]}};const resource={img:{bg:"assets/img/bg.png",flower1:"assets/img/flower_1.png",cloud:"assets/img/cloud.png",ground:"assets/img/ground.png",seed:"assets/img/seed.png",fingerPoint1:"assets/img/finger_point_1.png",fingerPoint2:"assets/img/finger_point_2.png",whiteSquare:"assets/img/white_square.png"},fonts:{pou:{type:"font",name:"Pou",srcs:["dist/fonts/Pou-RMR6.ttf"]}},particles:{rain:"assets/particle_rain.plist"},preload:{}};resource.preload={homeScene:[],playScene:[resource.img.bg,resource.img.flower1,resource.img.cloud,resource.img.ground,resource.img.seed,resource.fonts.pou,resource.particles.rain]};const PrefabSeed=cc.Sprite.extend({ctor:function(){this._super(),this.initWithFile(resource.img.seed),this.setAnchorPoint(0,0),this.setPosition(200,0),this.setScale(.2),this.setPositionX(.6*cc.director.getWinSize().width)},onEnter:function(){}}),PrefabPlant=cc.Sprite.extend({ctor:function(e,t=null){this._super(),this.resourceName=e,this.animationMode=t,this.initWithFile(`assets/img/plant_${e}_1.png`),this.setAnchorPoint(.5,0),this.setScale(.35),this.createSchedule()},onEnter:function(){if("flip"===this.animationMode)setInterval(()=>this.scaleX*=-1,3e3);else{var e=1;setInterval(()=>{++e>this.animationMode&&(e=1),this.setTexture(`assets/img/plant_${this.resourceName}_${e}.png`)},3e3)}},createSchedule(){this.scheduleOnce(()=>{console.log("s")})}}),PrefabFingerPointHelper=cc.Sprite.extend({flipFlop:!0,ctor:function(){this._super();const e=cc.director.getWinSize();this.initWithFile(resource.img.fingerPoint1),this.setPosition(e.width/2,e.height/2),this.flipImage()},flipImage:function(){this.schedule(()=>{model.user.firstTime?(this.flipFlop?this.setTexture(resource.img.fingerPoint2):this.setTexture(resource.img.fingerPoint1),this.flipFlop=!this.flipFlop):this.removeFromParent()},.7)}}),layers={play:{Bg:null,Level:null}};layers.play.Bg=cc.Layer.extend({ctor:function(){this._super(),this.printBg()},printBg:function(){const e=new cc.Sprite(resource.img.whiteSquare);e.setColor(cc.color.WHITE),e.setScaleX(cc.winSize.width/100+1),e.setScaleY(cc.winSize.height/100+1),e.setAnchorPoint(0,0),window.whiteRect=e,this.addChild(e,helper.zOrder.high)}}),layers.play.Level=cc.Layer.extend({seeds:[],plants:[],ctor:function(){this._super(),this.printLabels(),this.printHelper();const e=this.printCloud(),t=this.printRaindrop(e),i=this.printGround(),n=this.printSeed(),o=this.test();this.scheduleCloud(e,t),this.scheduleGround(i,[n,...o])},test(){const e=new PrefabPlant("flower_orchid",2);e.setPositionX(.1*cc.director.getWinSize().width),e.setPositionY(.25*cc.director.getWinSize().height);var t=!1;window.plant1=e,setInterval(()=>{e.setTexture(t?"assets/img/plant_flower_orchid_1.png":"assets/img/plant_flower_orchid_2.png"),t=!t},3e3),this.addChild(e,helper.zOrder.medium);const i=new PrefabPlant("flower_lotus","flip");return i.setPositionX(.3*cc.director.getWinSize().width),i.setPositionY(.25*cc.director.getWinSize().height),this.addChild(i,helper.zOrder.medium),[e,i]},printHelper(){if(!model.user.firstTime)return;const e=new PrefabFingerPointHelper;return this.addChild(e,helper.zOrder.low),e},printCloud:function(){const e=cc.Sprite.create(resource.img.cloud);return e.setAnchorPoint(.5,.5),e.setScale(.4),e.setPosition(-100,.85*cc.director.getWinSize().height),this.addChild(e,helper.zOrder.medium),e},printRaindrop:function(e){const t=cc.ParticleSystem.create(resource.particles.rain);return t.setScale(.6),t.setPosition(e.width/2,.35*e.height*-1),t.setAnchorPoint(0,0),t.setDrawMode(cc.ParticleSystem.TEXTURE_MODE),t.setBlendFunc(cc.BlendFunc.ALPHA_PREMULTIPLIED),e.addChild(t,helper.zOrder.low),t},printGround:function(){const e=new cc.Sprite(resource.img.ground);return e.setAnchorPoint(0,0),e.setPosition(-50,0),this.addChild(e,helper.zOrder.medium),e},printSeed:function(){const e=new PrefabSeed;return this.addChild(e,helper.zOrder.low),e},printLabels:function(){const e=cc.LabelTTF.create("Hujan",resource.fonts.pou.name,24);e.setPosition(.01*cc.director.getWinSize().width,cc.director.getWinSize().height-.01*cc.director.getWinSize().height),e.setColor("black"),e.setAnchorPoint(0,1),this.addChild(e,helper.zOrder.medium)},isCloudMoving:!1,lastTimeCloudAnimated:+new Date,scheduleCloud:function(e,t){e.schedule(t=>{if(+new Date<model.local.cloud.scheduleUpdatePos.on)return;const i=Math.abs(model.local.cloud.scheduleUpdatePos.x-e.x)/1e3,n=i<.5?.5:i,o=cc.moveTo(n,cc.p(model.local.cloud.scheduleUpdatePos.x,e.y)).clone().easing(cc.easeBackOut());e.runAction(cc.sequence(o)),model.local.cloud.scheduleUpdatePos.on=2*+new Date})},scheduleGround:function(e,t){e.scheduleOnce(()=>{for(let i of t){const t=.08*e.height;i.setPositionY(e.y+e.height-t)}})}});const HomeScene=cc.Scene.extend({onEnter:function(){this._super()}}),LevelScene=cc.Scene.extend({onEnter:function(){this._super(),this.createLayers(),this.addListener()},createLayers:function(){this.addChild(new layers.play.Bg,helper.zOrder.low),this.addChild(new layers.play.Level,helper.zOrder.medium)},setCloudPos(e){model.local.cloud.scheduleUpdatePos={x:e,on:+new Date},model.setUser("firstTime",!1)},addListener:function(){const e=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:(e,t)=>(this.setCloudPos(e.getLocationX(),!0),!0),onTouchEnded:(e,t)=>{}});cc.eventManager.addListener(e,this)}}),CollectionScene=cc.Scene.extend({onEnter:function(){this._super()}}),app={startGame:()=>{}};app.startGame=async()=>{await model.initUser();cc.game.run("gameCanvas",async()=>{cc.loader.onProgress=function(e,t,i){const n=100*e/t;console.log("progress",n),"production"===config.mode&&FBInstant.setLoadingProgress(n)},cc.director.setDisplayStats(config.debug),"production"===config.mode&&await FBInstant.initializeAsync(),cc.sys.isBrowser&&cc.sys.os===cc.sys.OS_ANDROID&&(cc.macro.DOWNLOAD_MAX_CONCURRENT=2),cc.LoaderScene.preload(resource.preload.playScene,(async function(){"production"===config.mode&&await FBInstant.startGameAsync(),cc.director.runScene(new LevelScene)}),this)})},window.onload=app.startGame;